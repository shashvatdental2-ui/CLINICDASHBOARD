<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DentalClinic Finance Manager</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard-card {
            transition: transform 0.3s ease;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        .vanta-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="vanta-bg" class="vanta-bg"></div>
    
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <i data-feather="activity" class="text-blue-600"></i>
                    <span class="font-bold text-xl text-blue-600">DentalFinance Pro</span>
                </div>
                <div class="hidden md:flex space-x-8">
                    <a href="#dashboard" class="text-gray-700 hover:text-blue-600 transition">Dashboard</a>
                    <a href="#transactions" class="text-gray-700 hover:text-blue-600 transition">Transactions</a>
                    <a href="#reports" class="text-gray-700 hover:text-blue-600 transition">Reports</a>
                    <a href="#settings" class="text-gray-700 hover:text-blue-600 transition">Settings</a>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">Sign In</button>
                    <button class="md:hidden">
                        <i data-feather="menu"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <section id="dashboard" class="mb-16" data-aos="fade-up">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Financial Dashboard</h1>
                <div class="flex space-x-4">
                    <select class="border rounded-lg px-4 py-2">
                        <option>Today</option>
                        <option>This Week</option>
                        <option>This Month</option>
                        <option>This Year</option>
                    </select>
                    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center" onclick="openNewEntryModal()">
                        <i data-feather="plus" class="mr-2"></i> New Entry
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                <div class="dashboard-card bg-white rounded-xl shadow-lg p-6 glass-effect" data-aos="zoom-in">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-gray-500">Total Income</h3>
                        <i data-feather="dollar-sign" class="text-green-500"></i>
                    </div>
                    <p class="text-3xl font-bold text-gray-800" data-card="total-income">$0.00</p>
                    <p class="text-green-500 text-sm">Calculated from entries</p>
                </div>
                
                <div class="dashboard-card bg-white rounded-xl shadow-lg p-6 glass-effect" data-aos="zoom-in" data-aos-delay="100">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-gray-500">Total Expenses</h3>
                        <i data-feather="trending-down" class="text-red-500"></i>
                    </div>
                    <p class="text-3xl font-bold text-gray-800" data-card="total-expenses">$0.00</p>
                    <p class="text-red-500 text-sm">Calculated from entries</p>
                </div>
                
                <div class="dashboard-card bg-white rounded-xl shadow-lg p-6 glass-effect" data-aos="zoom-in" data-aos-delay="200">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-gray-500">Net Profit</h3>
                        <i data-feather="bar-chart" class="text-blue-500"></i>
                    </div>
                    <p class="text-3xl font-bold text-gray-800" data-card="net-profit">$0.00</p>
                    <p class="text-blue-500 text-sm">Income - Expenses</p>
                </div>
                
                <div class="dashboard-card bg-white rounded-xl shadow-lg p-6 glass-effect" data-aos="zoom-in" data-aos-delay="300">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-gray-500">Patients Served</h3>
                        <i data-feather="users" class="text-purple-500"></i>
                    </div>
                    <p class="text-3xl font-bold text-gray-800" data-card="patients-served">0</p>
                    <p class="text-purple-500 text-sm">Consultation entries</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-16">
                <div class="bg-white rounded-xl shadow-lg p-6 glass-effect" data-aos="fade-right">
                    <h3 class="text-xl font-bold mb-6">Income vs Expenses</h3>
                    <canvas id="incomeExpenseChart" height="300"></canvas>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6 glass-effect" data-aos="fade-left">
                    <h3 class="text-xl font-bold mb-6">Category Breakdown</h3>
                    <canvas id="categoryChart" height="300"></canvas>
                </div>
            </div>
        </section>

        <section id="transactions" class="mb-16" data-aos="fade-up">
            <h2 class="text-2xl font-bold mb-6">Recent Transactions</h2>
            <div class="bg-white rounded-xl shadow-lg overflow-hidden glass-effect">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">12/05/2023</td>
                                <td class="px-6 py-4 whitespace-nowrap">Dental Checkup - John Smith</td>
                                <td class="px-6 py-4 whitespace-nowrap">Consultation</td>
                                <td class="px-6 py-4 whitespace-nowrap text-green-600">$150.00</td>
                                <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">Income</span></td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <button class="text-blue-600 hover:text-blue-800 mr-2"><i data-feather="edit"></i></button>
                                    <button class="text-red-600 hover:text-red-800"><i data-feather="trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">12/05/2023</td>
                                <td class="px-6 py-4 whitespace-nowrap">Dental Supplies Order</td>
                                <td class="px-6 py-4 whitespace-nowrap">Supplies</td>
                                <td class="px-6 py-4 whitespace-nowrap text-red-600">$245.50</td>
                                <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs">Expense</span></td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <button class="text-blue-600 hover:text-blue-800 mr-2"><i data-feather="edit"></i></button>
                                    <button class="text-red-600 hover:text-red-800"><i data-feather="trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">11/05/2023</td>
                                <td class="px-6 py-4 whitespace-nowrap">Teeth Whitening - Sarah Johnson</td>
                                <td class="px-6 py-4 whitespace-nowrap">Treatment</td>
                                <td class="px-6 py-4 whitespace-nowrap text-green-600">$320.00</td>
                                <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">Income</span></td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <button class="text-blue-600 hover:text-blue-800 mr-2"><i data-feather="edit"></i></button>
                                    <button class="text-red-600 hover:text-red-800"><i data-feather="trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">11/05/2023</td>
                                <td class="px-6 py-4 whitespace-nowrap">Monthly Rent</td>
                                <td class="px-6 py-4 whitespace-nowrap">Facility</td>
                                <td class="px-6 py-4 whitespace-nowrap text-red-600">$1,800.00</td>
                                <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs">Expense</span></td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <button class="text-blue-600 hover:text-blue-800 mr-2"><i data-feather="edit"></i></button>
                                    <button class="text-red-600 hover:text-red-800"><i data-feather="trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="reports" class="mb-16" data-aos="fade-up">
            <h2 class="text-2xl font-bold mb-6">Financial Reports</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6 glass-effect" data-aos="flip-left">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">Monthly Report</h3>
                        <select class="border rounded-lg px-3 py-1">
                            <option>May 2023</option>
                            <option>April 2023</option>
                            <option>March 2023</option>
                        </select>
                    </div>
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span>Total Income:</span>
                            <span class="font-bold text-green-600">$12,458.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Total Expenses:</span>
                            <span class="font-bold text-red-600">$3,248.50</span>
                        </div>
                        <div class="flex justify-between border-t pt-2">
                            <span>Net Profit:</span>
                            <span class="font-bold text-blue-600">$9,209.50</span>
                        </div>
                    </div>
                    <button class="w-full mt-6 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition flex items-center justify-center">
                        <i data-feather="download" class="mr-2"></i> Download PDF Report
                    </button>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6 glass-effect" data-aos="flip-right">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">Yearly Report</h3>
                        <select class="border rounded-lg px-3 py-1">
                            <option>2023</option>
                            <option>2022</option>
                            <option>2021</option>
                        </select>
                    </div>
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span>Total Income:</span>
                            <span class="font-bold text-green-600">$98,745.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Total Expenses:</span>
                            <span class="font-bold text-red-600">$32,156.75</span>
                        </div>
                        <div class="flex justify-between border-t pt-2">
                            <span>Net Profit:</span>
                            <span class="font-bold text-blue-600">$66,588.25</span>
                        </div>
                    </div>
                    <button class="w-full mt-6 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition flex items-center justify-center">
                        <i data-feather="download" class="mr-2"></i> Download PDF Report
                    </button>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6 glass-effect" data-aos="zoom-in">
                <h3 class="text-xl font-bold mb-6">Annual Performance</h3>
                <canvas id="annualChart" height="350"></canvas>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-12">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <div class="flex items-center space-x-2 mb-4">
                        <i data-feather="activity" class="text-blue-400"></i>
                        <span class="font-bold text-xl">DentalFinance Pro</span>
                    </div>
                    <p class="text-gray-400">Streamlining financial management for dental practices with precision and ease.</p>
                </div>
                
                <div>
                    <h4 class="font-bold mb-4">Quick Links</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#dashboard" class="hover:text-white transition">Dashboard</a></li>
                        <li><a href="#transactions" class="hover:text-white transition">Transactions</a></li>
                        <li><a href="#reports" class="hover:text-white transition">Reports</a></li>
                        <li><a href="#settings" class="hover:text-white transition">Settings</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-bold mb-4">Contact Us</h4>
                    <div class="space-y-2 text-gray-400">
                        <div class="flex items-center">
                            <i data-feather="mail" class="mr-2"></i>
                            <span>support@dentalfinancepro.com</span>
                        </div>
                        <div class="flex items-center">
                            <i data-feather="phone" class="mr-2"></i>
                            <span>+1 (555) 123-4567</span>
                        </div>
                        <div class="flex items-center">
                            <i data-feather="map-pin" class="mr-2"></i>
                            <span>123 Dental Street, Health City</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p>Â© 2023 DentalFinance Pro. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- New Entry Modal -->
    <div id="newEntryModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-800">New Transaction Entry</h3>
                <button onclick="closeNewEntryModal()" class="text-gray-500 hover:text-gray-700">
                    <i data-feather="x"></i>
                </button>
            </div>
            
            <form id="newEntryForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Transaction Type</label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-500 has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50">
                            <input type="radio" name="type" value="credit" class="sr-only" checked>
                            <div class="flex items-center">
                                <i data-feather="arrow-down-circle" class="text-green-500 mr-2"></i>
                                <span>Credit (Income)</span>
                            </div>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-red-500 has-[:checked]:border-red-500 has-[:checked]:bg-red-50">
                            <input type="radio" name="type" value="debit" class="sr-only">
                            <div class="flex items-center">
                                <i data-feather="arrow-up-circle" class="text-red-500 mr-2"></i>
                                <span>Debit (Expense)</span>
                            </div>
                        </label>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Amount</label>
                    <input type="number" step="0.01" min="0" placeholder="0.00" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea placeholder="Enter transaction description..." name="description"
                             class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                             rows="3" required></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" name="category" required>
                        <option value="">Select Category</option>
                        <option value="consultation">Consultation</option>
                        <option value="treatment">Treatment</option>
                        <option value="supplies">Supplies</option>
                        <option value="facility">Facility</option>
                        <option value="staff">Staff</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                    <input type="date" name="date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button type="button" onclick="closeNewEntryModal()" 
                            class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                        Cancel
                    </button>
                    <button type="submit" 
                            class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        Add Entry
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data storage and management
        let transactions = JSON.parse(localStorage.getItem('dentalFinanceTransactions')) || [];
        
        // New Entry Modal Functions
        function openNewEntryModal() {
            document.getElementById('newEntryModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeNewEntryModal() {
            document.getElementById('newEntryModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // Handle form submission
        document.getElementById('newEntryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const transaction = {
                id: Date.now(),
                date: formData.get('date'),
                description: formData.get('description'),
                category: formData.get('category'),
                amount: parseFloat(formData.get('amount')),
                type: formData.get('type'),
                timestamp: new Date().toISOString()
            };
            
            transactions.push(transaction);
            localStorage.setItem('dentalFinanceTransactions', JSON.stringify(transactions));
            
            updateDashboard();
            updateTransactionsTable();
            alert('Transaction added successfully!');
            closeNewEntryModal();
            this.reset();
        });

        // Close modal when clicking outside
        document.getElementById('newEntryModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeNewEntryModal();
            }
        });

        // Update dashboard with real data
        function updateDashboard() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            // Filter transactions for current month
            const monthTransactions = transactions.filter(transaction => {
                const transDate = new Date(transaction.date);
                return transDate.getMonth() === currentMonth && transDate.getFullYear() === currentYear;
            });
            
            // Calculate totals
            const totalIncome = monthTransactions
                .filter(t => t.type === 'credit')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const totalExpenses = monthTransactions
                .filter(t => t.type === 'debit')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const netProfit = totalIncome - totalExpenses;
            
            // Filter for patients served (assuming consultation category)
            const patientsServed = monthTransactions
                .filter(t => t.type === 'credit' && t.category === 'consultation')
                .length;
            
            // Update dashboard cards with proper currency formatting
            document.querySelector('[data-card="total-income"]').textContent = `${totalIncome.toFixed(2)}`;
            document.querySelector('[data-card="total-expenses"]').textContent = `${totalExpenses.toFixed(2)}`;
            document.querySelector('[data-card="net-profit"]').textContent = `${netProfit.toFixed(2)}`;
            document.querySelector('[data-card="patients-served"]').textContent = patientsServed;
            
            // Update charts
            updateCharts();
            
            // Debug: Log the calculations to console
            console.log('Dashboard Update:', {
                monthTransactions: monthTransactions.length,
                totalIncome: totalIncome,
                totalExpenses: totalExpenses,
                netProfit: netProfit,
                patientsServed: patientsServed
            });
        }

        // Update transactions table
        function updateTransactionsTable() {
            const tbody = document.querySelector('#transactions table tbody');
            tbody.innerHTML = '';
            
            // Sort by date descending
            const sortedTransactions = [...transactions].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            ).slice(0, 10); // Show last 10 transactions
            
            sortedTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${new Date(transaction.date).toLocaleDateString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${transaction.description}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${transaction.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap ${transaction.type === 'credit' ? 'text-green-600' : 'text-red-600'}">
                        ${transaction.amount.toFixed(2)}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 ${transaction.type === 'credit' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} rounded-full text-xs">
                            ${transaction.type === 'credit' ? 'Income' : 'Expense'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button class="text-blue-600 hover:text-blue-800 mr-2" onclick="editTransaction(${transaction.id})">
                            <i data-feather="edit"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-800" onclick="deleteTransaction(${transaction.id})">
                            <i data-feather="trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            feather.replace();
        }

        // Update charts with real data
        function updateCharts() {
            const now = new Date();
            const currentYear = now.getFullYear();
            
            // Get monthly data for current year
            const monthlyData = Array(12).fill(0).map((_, month) => {
                const monthTransactions = transactions.filter(transaction => {
                    const transDate = new Date(transaction.date);
                    return transDate.getMonth() === month && transDate.getFullYear() === currentYear;
                });
                
                return {
                    income: monthTransactions.filter(t => t.type === 'credit').reduce((sum, t) => sum + t.amount, 0),
                    expenses: monthTransactions.filter(t => t.type === 'debit').reduce((sum, t) => sum + t.amount, 0)
                };
            });
            
            // Update income vs expenses chart
            const incomeExpenseChart = Chart.getChart('incomeExpenseChart');
            if (incomeExpenseChart) {
                incomeExpenseChart.data.datasets[0].data = monthlyData.map(m => m.income);
                incomeExpenseChart.data.datasets[1].data = monthlyData.map(m => m.expenses);
                incomeExpenseChart.update();
            }
            
            // Update category breakdown
            const categoryData = {};
            transactions.forEach(transaction => {
                if (transaction.type === 'credit') {
                    categoryData[transaction.category] = (categoryData[transaction.category] || 0) + transaction.amount;
                }
            });
            
            const categoryChart = Chart.getChart('categoryChart');
            if (categoryChart) {
                categoryChart.data.datasets[0].data = Object.values(categoryData);
                categoryChart.data.labels = Object.keys(categoryData);
                categoryChart.update();
            }
            
            // Update annual performance chart
            const annualData = Array(6).fill(0).map((_, index) => {
                const year = currentYear - 5 + index;
                return transactions
                    .filter(transaction => new Date(transaction.date).getFullYear() === year)
                    .filter(t => t.type === 'credit')
                    .reduce((sum, t) => sum + t.amount, 0);
            });
            
            const annualChart = Chart.getChart('annualChart');
            if (annualChart) {
                annualChart.data.datasets[0].data = annualData;
                annualChart.update();
            }
        }

        // Transaction actions
        function editTransaction(id) {
            // Implementation for editing transaction
            alert('Edit functionality coming soon!');
        }

        function deleteTransaction(id) {
            if (confirm('Are you sure you want to delete this transaction?')) {
                transactions = transactions.filter(t => t.id !== id);
                localStorage.setItem('dentalFinanceTransactions', JSON.stringify(transactions));
                updateDashboard();
                updateTransactionsTable();
            }
        }

        // Initialize AOS
        AOS.init({
            duration: 1000,
            once: true
        });

        // Initialize Feather Icons
        feather.replace();

        // Initialize Vanta.js background
        VANTA.GLOBE({
            el: "#vanta-bg",
            mouseControls: true,
            touchControls: true,
            gyroControls: false,
            minHeight: 200.00,
            minWidth: 200.00,
            scale: 1.00,
            scaleMobile: 1.00,
            color: 0x3b82f6,
            backgroundColor: 0xf8fafc,
            size: 0.8
        });

        // Initialize charts and data on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Create empty charts first
            const incomeExpenseCtx = document.getElementById('incomeExpenseChart').getContext('2d');
            new Chart(incomeExpenseCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [
                        {
                            label: 'Income',
                            data: Array(12).fill(0),
                            backgroundColor: '#10B981',
                        },
                        {
                            label: 'Expenses',
                            data: Array(12).fill(0),
                            backgroundColor: '#EF4444',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#3B82F6',
                            '#10B981',
                            '#F59E0B',
                            '#EF4444',
                            '#8B5CF6',
                            '#6B7280'
                        ],
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });

            const annualCtx = document.getElementById('annualChart').getContext('2d');
            new Chart(annualCtx, {
                type: 'line',
                data: {
                    labels: Array(6).fill(0).map((_, i) => new Date().getFullYear() - 5 + i),
                    datasets: [{
                        label: 'Annual Revenue',
                        data: Array(6).fill(0),
                        borderColor: '#3B82F6',
                        tension: 0.3,
                        fill: true,
                        backgroundColor: 'rgba(59, 130, 246, 0.1)'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });

            // Update with real data
            updateDashboard();
            updateTransactionsTable();
        });
    </script>
</body>
</html>
